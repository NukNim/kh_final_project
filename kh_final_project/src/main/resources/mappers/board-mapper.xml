<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="boards">

	<select id="listAll"
		resultType="kh.com.job.board.model.dto.BoardDto">
		SELECT *
		FROM BOARD
		WHERE USER_ID =#{userId}
	</select>
	
	<select id="getboardNo">
		SELECT BOARD_NO FROM BOARD
	</select>
	
	<!-- 게시글 상세 -->
	<select id="viewDetail">
		SELECT BD.BOARD_NO,BD.CATEGORY_ID,BD.BOARD_TITLE,BD.BOARD_CONTENT,BD.BOARD_DATE,BD.UPDATE_DATE,
			   BD.BOARD_ORIGINAL_FILENAME,BD.BOARD_RENAME_FILENAME,BD.BOARD_READ,BD.BOARD_LIKE,
			   BD.TAG,BD.SALARY_AVG,BD.EMPLOYEE,BD.LINK,
			   UT.USER_ID,UT.USER_NAME,UT.USER_PHONE,UT.USER_EMAIL,UT.USER_PIC,UT.BS_TYPE,UT.BS_LICENSE,
			   UT.BS_MAIN_PHONE,UT.USER_ROLE,UT.ADDRESS_ROAD,UT.ADDRESS_JIBUN,UT.ADDRESS_DETAIL,UT.ADDRESS_POSTCODE
		FROM USER_TABLE UT
		JOIN BOARD BD ON UT.USER_ID = BD.USER_ID
		WHERE BD.BOARD_NO = #{boardNo}
	</select>


	
    
    <!--  게시글  -->
    <insert id="insertBoard">
    	INSERT INTO
		BOARD(BOARD_NO,USER_ID,CATEGORY_ID,BOARD_TITLE,BOARD_CONTENT,BOARD_DATE,UPDATE_DATE)
		VALUES(${boardNo},#{userId},#{categoryId},#{boardTitle},#{boardContent},CURRENT_TIMESTAMP,CURRENT_TIMESTAMP)
		<selectKey keyProperty="boardNo" resultType="_int"
			order="BEFORE">
			SELECT MAX(BOARD_NO) +1 FROM BOARD
		</selectKey>
    </insert>
    
    <!-- 게시글 상세조회  -->
   	<select id="detailBoard" resultType="bdto">
   	SELECT * FROM BOARD 
	WHERE BOARD_NO = #{boardNo}
	AND USER_ID = #{userId}
   	</select>

	<!--  게시글 목록 -->
	<select id="boardList" resultType="bdto">
	SELECT * FROM BOARD 
	WHERE CATEGORY_ID IN ('UBD01', 'UBD02','UBD03','UBD04' ) 
	ORDER BY UPDATE_DATE desc
	</select>
	
	<!-- 게시글 조회 순으로 조회 -->

	<!-- 회사소개 -->
	<insert id="insertCompanyInfo">
		INSERT INTO
		BOARD(BOARD_NO,USER_ID,CATEGORY_ID,BOARD_TITLE,BOARD_CONTENT,BOARD_DATE,UPDATE_DATE,TAG,SALARY_AVG,EMPLOYEE)
		VALUES(${boardNo},#{userId},'UDB06',#{boardTitle},#{boardContent},CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,#{tag},#{salaryAvg},#{employee})
		<selectKey keyProperty="boardNo" resultType="_int"
			order="BEFORE">
			SELECT MAX(BOARD_NO) +1 FROM BOARD
		</selectKey>
	</insert>

	<update id="updateCompanyInfo">
		UPDATE USER_TABLE SET
			BOARD_NO = ${boardNo},
			BOARD_CONTENT = #{boardContent},
			UPDATE_DATE = CURRENT_TIMESTAMP,
			TAG = #{tag},
			SALARY_AVG = #{salaryAvg},
			EMPLOYEE = #{employee}
		WHERE USER_ID = #{userId}
		<selectKey keyProperty="boardNo" resultType="_int"
			order="BEFORE">
			SELECT MAX(BOARD_NO) +1 FROM BOARD
		</selectKey>
	</update>
	
	<select id="viewCompanyInfo" resultType="bdto">
        SELECT USER_ID,BOARD_TITLE,BOARD_CONTENT,UPDATE_DATE,TAG,SALARY_AVG,EMPLOYEE
        FROM BOARD
        WHERE USER_ID = #{userId} AND CATEGORY_ID = 'UDB06'
    </select>
    
<<<<<<< HEAD
    <!--  게시글  -->
    <insert id="insertBoard">
    	INSERT INTO
		BOARD(BOARD_NO,USER_ID,CATEGORY_ID,BOARD_TITLE,BOARD_CONTENT,BOARD_DATE,UPDATE_DATE)
		VALUES(${boardNo},#{userId},#{categoryId},#{boardTitle},#{boardContent},CURRENT_TIMESTAMP,CURRENT_TIMESTAMP)
		<selectKey keyProperty="boardNo" resultType="_int"
			order="BEFORE">
			SELECT MAX(BOARD_NO) +1 FROM BOARD
		</selectKey>
    </insert>
    
    <!-- 게시글 상세조회  -->
   	<select id="detailBoard" resultType="bdto">
   	SELECT * FROM BOARD 
	WHERE BOARD_NO = #{boardNo}
   	</select>

	<!--  게시글 목록 -->
	<select id="boardList" resultType="bdto">
	SELECT * FROM BOARD 
	WHERE CATEGORY_ID IN ('UBD01', 'UBD02','UBD03','UBD04' ) 
	ORDER BY UPDATE_DATE desc
	</select>
	
	<!-- 게시글 조회 수 증가 -->
	<update id="updateRead">
	UPDATE BOARD 
	SET BOARD_READ = BOARD_READ + 1 
	WHERE BOARD_NO = #{boardNo}
	</update>
	
	<!-- 게시글 좋아요 증가 -->
	<update id="updateLike">
	UPDATE BOARD 
	SET BOARD_LIKE = BOARD_LIKE  + 1 
	WHERE BOARD_NO = #{boardNo}
	</update>
	
	<!-- 댓글 등록 -->
	<insert id="insertReply">
	INSERT INTO REPLY (REPLY_ID, BOARD_NO, USER_ID, REPLY_CONTENT, REPLY_CREATE_DATE, REPLY_LEVEL, REPLY_SEQ)
	VALUES (${replySeq}, #{boardNo}, #{userId}, #{replyContent}, SYSDATE, 1, ${replySeq})
	<selectKey keyProperty="replySeq" resultType="_int" order="BEFORE">
			SELECT MAX(REPLY_ID) +1 FROM REPLY
	</selectKey>
	</insert>
	
	
	<!-- 댓글 조회 -->
	<select id="replyList" resultType="redto">
	SELECT * FROM REPLY 
	WHERE BOARD_NO = #{boardNo}
	AND REPLY_LEVEL IN ('0','1')
	ORDER BY REPLY_CREATE_DATE ASC
	</select>


=======
>>>>>>> 490244e155da6577524cec79b4420a379937f967
	<!-- 뉴스레터 -->
	<insert id="insertNewsletter">
		INSERT INTO
		BOARD(BOARD_NO,USER_ID,CATEGORY_ID,BOARD_TITLE,BOARD_CONTENT,BOARD_DATE,LINK)
		VALUES(${boardNo},#{userId},'UDB05',#{boardTitle},#{boardContent},CURRENT_TIMESTAMP,#{link})
		<selectKey keyProperty="boardNo" resultType="_int"
			order="BEFORE">
			SELECT MAX(BOARD_NO) +1 FROM BOARD
		</selectKey>
	</insert>

	<update id="updateNewsLetter">
		UPDATE BOARD SET
		BOARD_NO = #{boardNo},
		UPDATE_DATE = CURRENT_TIMESTAMP,
		BOARD_CONTENT = #{boardContent},
		BOARD_TITLE = #{boardTitle},
		LINK = #{link}
		WHERE BOARD_NO = #{boardNo}
		AND USER_ID = #{userId}	
		<selectKey keyProperty="boardNo" resultType="_int"
			order="BEFORE">
			SELECT MAX(BOARD_NO) +1 FROM BOARD
		</selectKey>
	</update>
	
	<select id="newsLetterOne" resultType="bdto" >
		SELECT *
		FROM BOARD
		WHERE BOARD_NO = #{boardNo}
	</select>

	<select id="newsLetterList" resultType="bdto">
		SELECT *
		FROM BOARD
		WHERE USER_ID= #{userId} AND CATEGORY_ID = 'UDB05'
	</select>







	<!-- qna -->
	<insert id="insertQnA">
		INSERT INTO
		BOARD(BOARD_NO,USER_ID,CATEGORY_ID,BOARD_TITLE,BOARD_CONTENT,BOARD_DATE,LINK)
		VALUES(${boardNo},#{userId},'UDB04',#{boardTitle},#{boardContent},CURRENT_TIMESTAMP,#{link})
		<selectKey keyProperty="boardNo" resultType="String"
			order="BEFORE">
			SELECT MAX(BOARD_NO) +1 FROM BOARD
		</selectKey>
	</insert>








</mapper>