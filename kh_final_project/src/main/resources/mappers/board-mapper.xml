<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd" >
<mapper namespace="boards">

	<select id="listAll"
		resultType="kh.com.job.board.model.dto.BoardDto">
		SELECT *
		FROM BOARD
		WHERE USER_ID =#{userId}
	</select>
	
	<select id="getboardNo">
		SELECT BOARD_NO FROM BOARD
	</select>
	
	<!-- 게시글 상세 -->
	<select id="viewDetail">
		SELECT BD.BOARD_NO,BD.CATEGORY_ID,BD.BOARD_TITLE,BD.BOARD_CONTENT,BD.BOARD_DATE,BD.UPDATE_DATE,
			   BD.BOARD_ORIGINAL_FILENAME,BD.BOARD_RENAME_FILENAME,BD.BOARD_READ,BD.BOARD_LIKE
			   BD.TAG,BD.SALARY_AVG,BD.EMPLOYEE,BD.LINK
			   UT.USER_ID,UT.USER_NAME,UT.USER_PHONE,UT.USER_EMAIL,UT.USER_PIC,UT.BS_TYPE,UT.BS_LICENSE,
			   UT.BS_MAIN_PHONE,UT.USER_ROLE,UT.ADDRESS_ROAD,UT.ADDRESS_JIBUN,UT.ADDRESS_DETAIL,UT.ADDRESS_POSTCODE
		FROM USER_TABLE UT
		JOIN BOARD BD ON UT.USER_ID = BD.USER_ID
		WHERE BD.BOARD_NO = #{boardNo}
	</select>


	<!-- 회사소개 -->
	<insert id="insertCompanyInfo">
		INSERT INTO
		BOARD(BOARD_NO,USER_ID,CATEGORY_ID,BOARD_TITLE,BOARD_CONTENT,BOARD_DATE,UPDATE_DATE,TAG,SALARY_AVG,EMPLOYEE)
		VALUES(${boardNo},#{userId},'UDB06',#{boardTitle},#{boardContent},CURRENT_TIMESTAMP,CURRENT_TIMESTAMP,#{tag},#{salaryAvg},#{employee})
		<selectKey keyProperty="boardNo" resultType="_int"
			order="BEFORE">
			SELECT MAX(BOARD_NO) +1 FROM BOARD
		</selectKey>
	</insert>

	<update id="updateCompanyInfo">
		UPDATE USER_TABLE SET
			BOARD_NO = ${boardNo},
			BOARD_CONTENT = #{boardContent},
			UPDATE_DATE = CURRENT_TIMESTAMP,
			TAG = #{tag},
			SALARY_AVG = #{salaryAvg},
			EMPLOYEE = #{employee}
		WHERE USER_ID = #{userId}
		<selectKey keyProperty="boardNo" resultType="_int"
			order="BEFORE">
			SELECT MAX(BOARD_NO) +1 FROM BOARD
		</selectKey>
	</update>
	
	<select id="viewCompanyInfo" resultType="bdto">
        SELECT USER_ID,BOARD_TITLE,BOARD_CONTENT,UPDATE_DATE,TAG,SALARY_AVG,EMPLOYEE
        FROM BOARD
        WHERE USER_ID = #{userId} AND CATEGORY_ID = 'UDB06'
    </select>





	<!-- 뉴스레터 -->
	<insert id="insertNewsletter">
		INSERT INTO
		BOARD(BOARD_NO,USER_ID,CATEGORY_ID,BOARD_TITLE,BOARD_CONTENT,BOARD_DATE,LINK)
		VALUES(${boardNo},#{userId},'UDB05',#{boardTitle},#{boardContent},CURRENT_TIMESTAMP,#{link})
		<selectKey keyProperty="boardNo" resultType="_int"
			order="BEFORE">
			SELECT MAX(BOARD_NO) +1 FROM BOARD
		</selectKey>
	</insert>

	<update id="updateNewsLetter">
		UPDATE BOARD SET
		BOARD_NO = #{boardNo},
		UPDATE_DATE = CURRENT_TIMESTAMP,
		BOARD_CONTENT = #{boardContent},
		BOARD_TITLE = #{boardTitle},
		LINK = #{link}
		WHERE BOARD_NO = #{boardNo}
		AND USER_ID = #{userId}	
		<selectKey keyProperty="boardNo" resultType="_int"
			order="BEFORE">
			SELECT MAX(BOARD_NO) +1 FROM BOARD
		</selectKey>
	</update>
	
	<select id="newsLetterOne" resultType="bdto" >
		SELECT *
		FROM BOARD
		WHERE BOARD_NO = #{boardNo}
	</select>

	<select id="newsLetterList" resultType="bdto">
		SELECT *
		FROM BOARD
		WHERE USER_ID= #{userId} AND CATEGORY_ID = 'UDB05'
	</select>







	<!-- qna -->
	<insert id="insertQnA">
		INSERT INTO
		BOARD(BOARD_NO,USER_ID,CATEGORY_ID,BOARD_TITLE,BOARD_CONTENT,BOARD_DATE,LINK)
		VALUES(${boardNo},#{userId},'UDB04',#{boardTitle},#{boardContent},CURRENT_TIMESTAMP,#{link})
		<selectKey keyProperty="boardNo" resultType="String"
			order="BEFORE">
			SELECT MAX(BOARD_NO) +1 FROM BOARD
		</selectKey>
	</insert>








</mapper>